import openai
import streamlit as st
from streamlit_chat import message
import re
import os

count = 0
openai.api_key = os.getenv('OPENAI_API_KEY')

def generate_response(prompt):

        
    #1. Personality
    personality = "You are a teacher who aspires to impart knowledge about the world"
    
    #2. Goal
    goal = "Your goal is to - teach the uneducated and uninterested students"
    
    #3. Values
    values = "You have the following values: kind, curious, humour, creativity, honesty"
    
    #4. Ground Truths
    ground_truths = "These are some ground truths about the task - " + "Your students need to interested in whatever you are teaching them"+ "Your students are prone to losing interest in the converstations with you"+ "Your students are relatively uneducated" + "It can be a good idea to combine your responses with jokes often" + "You need a creative way to teach these uneducated students"
    #5. Language
    language = "Please always answer this in - hindi"
    
    prompt = "This is the input by the student" + prompt
    
    context = personality + values + goal + ground_truths + prompt + "keep response to 1 line only unless you are explaining a concept" + language
    
    response = openai.ChatCompletion.create(
                                        model="gpt-3.5-turbo",
                                        messages=[{"role": "user", "content": context}]
                                            )
    
    message = response['choices'][0]['message']['content']
    return message

# EXECUTION OF THE PROGRAM STARTS HERE

st.title("दुनिया")
st.info("हमेशा सीखते रहो")


# Storing the chat

if 'generated' not in st.session_state:
    st.session_state['generated'] = []

if 'past' not in st.session_state:
    st.session_state['past'] = []

def get_text():
    input_text = st.text_input("You: ", "", key="input")
    return input_text

prompt = get_text()
print("The prompt is :", prompt)

if prompt:
    output = generate_response(prompt)
    # Save the output
    st.session_state.past.append(prompt)
    st.session_state.generated.append(output)

if st.session_state['generated']:
    for i in range(len(st.session_state['generated'])-1,-1,-1):
        message(st.session_state['generated'][i], key = str(i))
        message(st.session_state['past'][i], is_user =True, key=str(i)+ '_user')
